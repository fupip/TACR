# 策略测试使用指南

本项目现已支持在测试阶段对比不同交易策略的表现，包括 TACR 模型、均线策略和随机策略。

## 支持的策略

1. **TACR 模型** (`model`): 基于 Transformer 的强化学习交易模型
2. **均线策略** (`ma`): 基于 5日、20日、60日移动平均线的交叉策略  
3. **随机策略** (`random`): 随机选择买入/卖出/持有动作的基线策略

## 使用方法

### 方式 1: 单独测试某个策略

```bash
# 测试 TACR 模型
python test.py --dataset csi --test_strategy model

# 测试均线策略
python test.py --dataset csi --test_strategy ma --ma_strategy_id 1 --ma_threshold 0.2

# 测试随机策略  
python test.py --dataset csi --test_strategy random
```

### 方式 2: 使用对比测试脚本

```bash
# 测试所有策略并对比结果
python test_strategies.py --dataset csi

# 使用简化的运行脚本
python run_strategy_comparison.py --dataset csi
```

## 参数说明

### 通用参数
- `--dataset`: 数据集选择 (csi, dow, kdd, hightech, ndx, mdax)
- `--seed`: 随机种子，确保结果可重现
- `--test_strategy`: 测试策略类型 (model, ma, random)

### 模型相关参数
- `--u`: 序列长度
- `--embed_dim`: 嵌入维度
- `--n_layer`: Transformer层数
- `--n_head`: 注意力头数
- `--dropout`: Dropout率

### 均线策略参数
- `--ma_strategy_id`: 策略强度参数 (1-10)
- `--ma_threshold`: 阈值倍数 (0.1-1.0)

## 策略详解

### 均线策略逻辑
- **买入信号**: 5日均线 > 20日均线*(1+阈值) 且 收盘价 > 60日均线
- **卖出信号**: 5日均线 < 20日均线*(1-阈值) 且 收盘价 < 60日均线  
- **持有信号**: 其他情况

### 输出结果
测试完成后会显示:
- 总回报
- 交易天数
- 夏普比率
- 相对于基线的表现提升

## 示例输出

```
============================================================
开始策略对比测试
============================================================

1. 测试 TACR 模型...
TACR 模型回报: 0.1250, 交易天数: 252

2. 测试均线策略...  
均线策略回报: 0.0850, 交易天数: 252

3. 测试随机策略...
随机策略回报: 0.0200, 交易天数: 252

============================================================
策略对比结果
============================================================
TACR 模型:      0.1250
均线策略:      0.0850  
随机策略:      0.0200
============================================================
TACR vs 随机:   +525.00%
均线 vs 随机:   +325.00%  
TACR vs 均线:    +47.06%
```

## 注意事项

1. 确保已安装所有依赖库
2. 确保数据集文件存在于 `datasets/` 目录
3. 对于模型测试，需要相应的模型权重文件
4. 建议使用相同的随机种子进行公平对比
5. 均线策略需要数据中包含相应的技术指标列

## 扩展功能

如需添加更多策略，可以:
1. 在 `preprocessor/strategies/` 目录下创建新策略类
2. 继承 `BaseStrategy` 类
3. 实现 `calculate_position_and_action` 方法
4. 在测试脚本中添加相应选项 